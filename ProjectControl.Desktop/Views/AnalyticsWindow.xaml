<Window x:Class="ProjectControl.Desktop.Views.AnalyticsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ProjectControl.Desktop.Converters"
        Title="Аналитика"
        Height="500"
        Width="1500"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <conv:TimeFormatConverter x:Key="TimeFormat" />
    </Window.Resources>
    <DockPanel Margin="10">
        <StackPanel Orientation="Vertical" Margin="0,0,0,10" VerticalAlignment="Top">
            <CheckBox Content="Только завершённые" IsChecked="{Binding CompletedOnly}" Margin="0,0,10,0" Checked="OnFilterChanged" Unchecked="OnFilterChanged"/>
            <TextBlock Text="От" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding FromDate}" Margin="5,0" Width="110"/>
            <TextBlock Text="До" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding ToDate}" Margin="5,0" Width="110"/>
            <TextBlock Text="Заказчик" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <ComboBox ItemsSource="{Binding Customers}" SelectedItem="{Binding SelectedCustomer}" DisplayMemberPath="Name" Width="120" Margin="5,0"/>
            <TextBlock Text="Сумма" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <TextBox Width="60" Text="{Binding AmountFrom, UpdateSourceTrigger=PropertyChanged}" Margin="5,0"/>
            <TextBlock Text="-" VerticalAlignment="Center"/>
            <TextBox Width="60" Text="{Binding AmountTo, UpdateSourceTrigger=PropertyChanged}" Margin="5,0"/>
            <Button Content="Фильтр" Margin="10,0,0,0" Click="OnFilterChanged" Width="60"/>
        </StackPanel>
        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Экспорт CSV" Width="100" Margin="0,0,10,0" Click="OnExportCsv"/>
            <TextBlock VerticalAlignment="Center" Margin="0,0,10,0"
                       Text="{Binding TotalPayment, StringFormat={}{0:C}}" />
            <TextBlock VerticalAlignment="Center"
                       Text="{Binding TotalTimeSpent, Converter={StaticResource TimeFormat}}" />
        </StackPanel>
        <ListView ItemsSource="{Binding Projects}">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Проект" DisplayMemberBinding="{Binding Name}" Width="120"/>
                    <GridViewColumn Header="Заказчик" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Customer.Name}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Статус" DisplayMemberBinding="{Binding Status}" Width="100"/>
                    <GridViewColumn Header="Оплата" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding PaymentAmount, StringFormat={}{0:C}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Время" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding TotalTimeSpent, Converter={StaticResource TimeFormat}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
    </DockPanel>
</Window>
